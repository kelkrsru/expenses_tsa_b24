{% extends 'base_deal.html' %}

{% block title %}{{ title }}{% endblock %}
{% block content %}
  <div class="container mt-5">
    <div class="row row-cols-2 row-cols-lg-4 row-cards">
      <div class="col">
        <div class="card card-calc text-center">
          <div class="card-header blue">
            <span>–í—ã—Ä—É—á–∫–∞, —Ä—É–±.</span>
          </div>
          <div class="card-body">
            <span>{{ calculations.proceeds }}</span>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="card card-calc text-center">
          <div class="card-header blue">
            <span>–ó–∞—Ç—Ä–∞—Ç—ã, —Ä—É–±.</span>
          </div>
          <div class="card-body">
            <span>{{ calculations.sum_expenses }}</span>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="card card-calc text-center">
          <div class="card-header blue">
            <span>–ü—Ä–∏–±—ã–ª—å, —Ä—É–±.</span>
          </div>
          <div class="card-body">
            <span>{{ calculations.income }}</span>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="card card-calc text-center">
          <div class="card-header blue">
            <span>–†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å, %</span>
          </div>
          <div class="card-body">
            <span>{{ calculations.profitability }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="container">
    {% load user_filters %}
    {% for product in bx24_obj.deal_products %}
      <table class="table table-border table-margin-top table-products">
        <thead>
          <tr>
            <th class="col-1" scope="col">#</th>
            <th class="col-3" scope="col">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏</th>
            <th class="col-2" scope="col">–¶–µ–Ω–∞, —Ä—É–±.</th>
            <th class="col-1" scope="col">–ö–æ–ª-–≤–æ</th>
            <th class="col-2" scope="col">–°—É–º–º–∞ –±–µ–∑ –ù–î–°, —Ä—É–±.</th>
            <th class="col-1" scope="col">–ù–î–°, %</th>
            <th class="col-2" scope="col">–°—É–º–º–∞ —Å –ù–î–°, —Ä—É–±.</th>
          </tr>
        </thead>
        <tbody>
          <tr class="tr-green">
            <th scope="row">{{ forloop.counter }}</th>
            <td>{{ product.PRODUCT_NAME }}</td>
            <td>{{ product.PRICE_EXCLUSIVE|floatformat:2 }}</td>
            <td>{{ product.QUANTITY }}</td>
            <td>{% multiply product.PRICE_EXCLUSIVE product.QUANTITY %}</td>
            <td>{{ product.TAX_RATE }}</td>
            <td>{% multiply product.PRICE product.QUANTITY %}</td>
          </tr>
        </tbody>
      </table>
      <div class="card card-expenses">
        <div class="card-header">
          –ó–∞—Ç—Ä–∞—Ç—ã
        </div>
        <div class="card-body">
          <table class="table table-border table-striped">
            <thead>
              <tr>
                <th scope="col" width="30%">–°—Ç–∞—Ç—å—è –∑–∞—Ç—Ä–∞—Ç</th>
                <th scope="col" width="10%">–°—É–º–º–∞, —Ä—É–±.</th>
                <th scope="col" width="10%">–ì—Ä—É–∑</th>
                <th scope="col" width="10%">–ö–æ–º–ø–∞–Ω–∏—è</th>
                <th scope="col" width="10%">–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
                <th scope="col" width="10%">–í–∏–¥ –æ–ø–ª–∞—Ç—ã</th>
                <th scope="col" width="10%">–î–æ–∫—É–º–µ–Ω—Ç</th>
                <th scope="col" width="10%">–î–µ–π—Å—Ç–≤–∏—è</th>
              </tr>
            </thead>
            <tbody>
              {% load user_filters %}
              {% for expense in expenses %}
                {% if expense.product_id == product.ID|to_int %}
                  <tr>
                    <td>{{ expense.cost_item }}</td>
                    <td>{{ expense.expense}}</td>
                    <td>{{ expense.cargo|emptyvalue }}</td>
                    <td>{{ expense.company|emptyvalue }}</td>
                    <td>{{ expense.employee|emptyvalue }}</td>
                    <td>{{ expense.type_cost|emptyvalue }}</td>
                    <td>{{ expense.document|emptyvalue }}</td>
                    <td>
                      <a
                              href="{% url 'dealcard:edit_expense' expense.pk %}?deal_id={{ deal_id }}&member_id={{ portal.member_id }}"
                              class="btn btn-primary shadow-none btn-small"
                              title="–ò–∑–º–µ–Ω–∏—Ç—å"
                      >
                        üóò
                      </a>
                      <a
                              href="{% url 'dealcard:add_expense' %}?deal_id={{ deal_id }}&product_id={{ product.ID }}&member_id={{ portal.member_id }}&expense={{ expense.pk }}"
                              class="btn btn-info shadow-none btn-small"
                              title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å"
                      >
                        üìë
                      </a>
                      <a
                              href="{% url 'dealcard:delete_expense' expense.pk %}?deal_id={{ deal_id }}&member_id={{ portal.member_id }}"
                              class="btn btn-danger shadow-none btn-small"
                              title="–£–¥–∞–ª–∏—Ç—å"
                      >
                        ‚úñ
                      </a>
                    </td>
                  </tr>
                {% endif %}
              {% endfor %}
            </tbody>
          </table>
        </div>

        <div class="card-footer">
          <a
                  href="{% url 'dealcard:add_expense' %}?deal_id={{ deal_id }}&product_id={{ product.ID }}&member_id={{ portal.member_id }}"
                  class="btn btn-primary shadow-none"
          >
            –î–æ–±–∞–≤–∏—Ç—å –∑–∞—Ç—Ä–∞—Ç—ã –∫ —É—Å–ª—É–≥–µ
          </a>
        </div>
      </div>
    {% endfor %}
  </div>
{% endblock %}
